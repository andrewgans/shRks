---
title: "sharkie"
author: "shRks"
date: "2023-12-04"
output: html_document
bibliography: "shRks.bib"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(MuMIn)
library(rgbif)
library(data.table)
```

#Question:

Does change in surface water temperature affect shark migration patterns? 

# Delineating the area of interest:

Used "measure a distance" tool in google maps to determine a rectangle encompassing the region we were interested in (see screenshot) Bottom left coordinates: 41.02923, -71.72927 Top left coordinates: 45.11812, -71.74585 Top right coordinates: 45.11812, -66.06430 Bottom right coordinates: 40.99269, -66.12886

![Screenshot of region of interest](northeastregion.png)

## Determining species that are migratory and pass through this region:

```{r finding potential species, include = FALSE}

potspp <- occ_data(scientificName = "Elasmobranchii", 
                   basisOfRecord = "HUMAN_OBSERVATION", 
                   year = "2000,2023",
                   decimalLatitude = "41.0,45.0", 
                   decimalLongitude = "-71.0,-66.0", 
                   )[[2]]
potspp %>%
  select(scientificName) %>%
  unique() %>%
  print()
```

#### Occurence data indicates that a number of shark species have been identified in our region of interest since 2000. Using information from the National Oceanic and Atmospheric Administration, we can narrow down the list of species to those that exhibit migratory behavior between the area of interest and the mid-Atlantic/Southeast waters (@NOAAmigration):

Cetorhinus maximus (basking shark)

Isurus oxyrinchus (shortfin mako)

Mustelus canis (smooth dogfish)

Lamna nasus (porbeagle)

Squalus acanthias (spurdog)

Carcharias taurus (sand tiger shark)

Carcharhinus plumbeus (sandbar shark)

Carcharodon carcharias (great white shark)

Prionace glauca (blue shark)

Carcharhinus obscurus (dusky shark)



```{r, cache = TRUE}
spp <- c("Cetorhinus maximus","Isurus oxyrhinchus","Mustelus canus", "Lamna nasus", "Squalus acanthias", "Carcharias taurus", "Carcharhinus plumbeus", "Carcharodon carcharias", "Prionace glauca", "Carcharhinus obscurus")
y <- paste0("2000",",","2023")
m <- paste0("5",",","8")

dat.l <-list()

for(s in spp){
  n.obs <-  occ_data(scientificName = s, year = y, month = m, limit = 1000, country="US", basisOfRecord = "HUMAN_OBSERVATION")$meta$count 

dat.l[[paste0(s)]] <- occ_data(scientificName = s,year=y,month=m,
                               limit=1000, country="US",
                               basisOfRecord = "HUMAN_OBSERVATION", 
                               decimalLatitude = "41.0,45.0", 
                               decimalLongitude = "-71.0,-66.0", 
                   )[[2]]

}

dat <- rbindlist(dat.l,fill=T)

dat%>%
  group_by(year,species)%>%
  summarise(count=sum(individualCount,na.rm = T))%>%
  ggplot(aes(x=year,y=count,col=species))+geom_point()

```

```{r assumed migration path}

```

``` {r when arrival}
#let's find the day? for which 25% of each spp has arrived to the area
#need:
  #total # individuals for each spp for each year for our time frame
  #model arrival process as a logistic curve

cm <- dat %>%
  filter(species == "Cetorhinus maximus") %>%
  group_by(year) %>%
  mutate(date = as.Date(paste0(year,"-",month,"-",day)),
         j.day = julian(date, origin = as.Date(paste0(unique(year),"-01-01")))) %>%
  group_by(species, year, j.day, date) %>%
  summarise(day.tot = sum(individualCount,na.rm=T)) %>%
  group_by(species, year) %>%
  mutate(prop = cumsum(day.tot/sum(day.tot,na.rm = T))) %>%
  filter(year>1999)

cm %>%
  ggplot(aes(j.day,prop))+geom_point()+facet_wrap(year~.) #not super logistic looking curves (after 2015/2016)

sa <- dat %>%
  filter(species == "Squalus acanthias") %>%
  group_by(year) %>%
  mutate(date = as.Date(paste0(year,"-",month,"-",day)),
         j.day = julian(date, origin = as.Date(paste0(unique(year),"-01-01")))) %>%
  group_by(species, year, j.day, date) %>%
  summarise(day.tot = sum(individualCount,na.rm=T)) %>%
  group_by(species, year) %>%
  mutate(prop = cumsum(day.tot/sum(day.tot,na.rm = T))) %>%
  filter(year>1999)

sa %>%
  ggplot(aes(j.day,prop))+geom_point()+facet_wrap(year~.) #not logistic looking either

```

## References

